# üìù –ü—ñ–¥—Å—É–º–æ–∫ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É - –í–µ—Ä—Å—ñ—è 2.1

## üéØ –í–∏–∫–æ–Ω–∞–Ω—ñ –ó–∞–≤–¥–∞–Ω–Ω—è

### 1. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ó–Ω–∏–∫–Ω–µ–Ω–Ω—è –ö–Ω–æ–ø–∫–∏ "–ü–æ—á–∞—Ç–∏ –ì—Ä—É"
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–Ω–æ–ø–∫–∞ –∑–Ω–∏–∫–∞–ª–∞ –ø—ñ—Å–ª—è –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –≤—Å—ñ—Ö –≥—Ä–∞–≤—Ü—ñ–≤
- **–ü—Ä–∏—á–∏–Ω–∞**: WebSocket reconnect –ø–æ—Ä—É—à—É–≤–∞–≤ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å Alpine.js
- **–†—ñ—à–µ–Ω–Ω—è**:
  - –ü–æ–∫—Ä–∞—â–µ–Ω–æ WebSocket connection management
  - –î–æ–¥–∞–Ω–æ broadcast `player_joined` event
  - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–µ–∞–∫—Ç–∏–≤–Ω–∏–π `playerCount` getter
  - –î–æ–¥–∞–Ω–æ cleanup handlers

**–§–∞–π–ª–∏**:
- `frontend/static/js/game.js` - WebSocket logic
- `backend/app/routers/games.py` - player_joined broadcast
- `frontend/templates/game.html` - debug logging

---

### 2. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ó–∞–≤–∏—Å–∞–Ω–Ω—è –Ω–∞ "–í—ñ–¥–∫—Ä–∏–≤–∞–Ω–Ω—è –ë—É–Ω–∫–µ—Ä–∞"
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ì—Ä–∞ –∑–∞–≤–∏—Å–∞–ª–∞ –Ω–∞ —Ñ–∞–∑—ñ `bunker_reveal`, —Ç–∞–π–º–µ—Ä –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–≤ —Ñ–∞–∑–∏
- **–ü—Ä–∏—á–∏–Ω–∞**: 
  - –¢–∞–π–º–µ—Ä –ª–æ–≥—É–≤–∞–≤ —Ç—ñ–ª—å–∫–∏ –¥–ª—è `bunker_reveal` (–∞–ª–µ —Ü–µ –Ω–µ –±–ª–æ–∫—É–≤–∞–ª–æ)
  - –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ `isHost` —á–µ—Ä–µ–∑ reconnect
  - –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π debugging
- **–†—ñ—à–µ–Ω–Ω—è**:
  - –ü–æ–∫—Ä–∞—â–µ–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞ (–∫–æ–∂–Ω—ñ 5 —Å–µ–∫ –¥–ª—è –≤—Å—ñ—Ö —Ñ–∞–∑)
  - –î–æ–¥–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è `phase_end_time` –¥–ª—è debugging
  - –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—å–æ–≥–æ `phase_end_time` –∑ ‚ö†Ô∏è
  - –ü–æ–∫—Ä–∞—â–µ–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ auto-advance

**–§–∞–π–ª–∏**:
- `frontend/static/js/game.js` - timer logging improvements

---

### 3. ‚ö†Ô∏è –î–æ–¥–∞–Ω–æ UI –¥–ª—è –û—Å–æ–±–ª–∏–≤–∏—Ö –£–º–æ–≤ (Placeholder)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Å–æ–±–ª–∏–≤—ñ –£–º–æ–≤–∏ –Ω–µ –º–∞–ª–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
- **–ó promt.md**: 32 —Ç–∏–ø–∏ –û—Å–æ–±–ª–∏–≤–∏—Ö –£–º–æ–≤ - –≤–∞–∂–ª–∏–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ –≥—Ä–∏
- **–†—ñ—à–µ–Ω–Ω—è**:
  - –î–æ–¥–∞–Ω–æ –∫–Ω–æ–ø–∫—É "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏"
  - –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ `special_condition` —ñ—Å–Ω—É—î
  - –ó–Ω–∏–∫–∞—î –ø—ñ—Å–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (`special_used = true`)
  - **TODO**: Backend endpoint `/use-special` —Ç–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ—ó —É–º–æ–≤–∏

**–§–∞–π–ª–∏**:
- `frontend/templates/game.html` - special conditions UI

---

### 4. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ WebSocket Connection
- **–ü—Ä–æ–±–ª–µ–º–∞**: –î—É–±–ª—ñ–∫–∞—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω—å, –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å cleanup
- **–†—ñ—à–µ–Ω–Ω—è**:
  - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `wsConnecting` flag
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ WS
  - Exponential backoff –¥–ª—è reconnect (1s ‚Üí 2s ‚Üí 4s ‚Üí max 10s)
  - `beforeunload` handler –¥–ª—è cleanup

**–§–∞–π–ª–∏**:
- `frontend/static/js/game.js`

---

### 5. ‚úÖ Rate Limiting –¥–ª—è `advance_phase`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–æ–∂–ª–∏–≤—ñ –ø–æ–¥–≤—ñ–π–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ —á–µ—Ä–µ–∑ —Ç–∞–π–º–µ—Ä + —Ä—É—á–Ω–∏–π skip
- **–†—ñ—à–µ–Ω–Ω—è**: In-memory cache –∑ 1-—Å–µ–∫—É–Ω–¥–Ω–∏–º debounce

**–§–∞–π–ª–∏**:
- `backend/app/routers/games.py`

---

### 6. ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –î–∞–Ω–∏—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞**: `revealed_cards` –Ω–µ –∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å
- **–†—ñ—à–µ–Ω–Ω—è**: –ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–¥–∞—î–º–æ –º–∞—Å–∏–≤ (–Ω–µ `null`)

**–§–∞–π–ª–∏**:
- `backend/app/routers/games.py`
- `backend/app/websockets/websocket_routes.py`

---

## üìÇ –°—Ç–≤–æ—Ä–µ–Ω—ñ –î–æ–∫—É–º–µ–Ω—Ç–∏

1. **`REFACTORING_SUMMARY.md`**  
   –ü–æ–≤–Ω–∏–π –æ–≥–ª—è–¥ –ø—Ä–æ–±–ª–µ–º —ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø–µ—Ä—à–æ—ó —Ö–≤–∏–ª—ñ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

2. **`BUNKER_REVEAL_FIX.md`**  
   –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º–∏ –∑–∞–≤–∏—Å–∞–Ω–Ω—è –Ω–∞ bunker_reveal —Ñ–∞–∑—ñ

3. **`restart.sh`**  
   –®–≤–∏–¥–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É Docker

---

## üß™ –Ø–∫ –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏

### –¢–µ—Å—Ç #1: –ö–Ω–æ–ø–∫–∞ "–ü–æ—á–∞—Ç–∏ –ì—Ä—É"
1. –°—Ç–≤–æ—Ä—ñ—Ç—å –≥—Ä—É
2. –ü—Ä–∏—î–¥–Ω–∞–π—Ç–µ 3+ –≥—Ä–∞–≤—Ü—ñ–≤ –∑ —Ä—ñ–∑–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤
3. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ö–æ—Å—Ç–∞ (F5)
4. **–û—á—ñ–∫—É–≤–∞–Ω–Ω—è**: –ö–Ω–æ–ø–∫–∞ "–ü–æ—á–∞—Ç–∏ –ì—Ä—É" –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤–∏–¥–∏–º–æ—é
5. **Console**: –ú–∞—î –ª–æ–≥—É–≤–∞—Ç–∏ `[UI] Start button visibility: true...`

### –¢–µ—Å—Ç #2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –§–∞–∑
1. –ü–æ—á–Ω—ñ—Ç—å –≥—Ä—É –∑ 4+ –≥—Ä–∞–≤—Ü—è–º–∏
2. –ó–∞—á–µ–∫–∞–π—Ç–µ 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ñ–∞–∑—ñ `bunker_reveal`
3. **–û—á—ñ–∫—É–≤–∞–Ω–Ω—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ `card_reveal`
4. **Console** (—Ö–æ—Å—Ç):
   ```
   [TIMER] Phase: bunker_reveal, Remaining: 5s, isHost: true...
   [TIMER] ‚è∞ Time expired! Auto-advancing phase as host...
   Phase advanced successfully
   ```

### –¢–µ—Å—Ç #3: WebSocket Reconnect
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ DevTools ‚Üí Network ‚Üí WS
2. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É (F5)
3. **–û—á—ñ–∫—É–≤–∞–Ω–Ω—è**: 
   - –¢—ñ–ª—å–∫–∏ 1 WebSocket –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
   - –õ–æ–≥—É–≤–∞–Ω–Ω—è `[WS] Closing existing connection` (—è–∫—â–æ –±—É–ª–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—î)
   - `[WS] WebSocket connected`

### –¢–µ—Å—Ç #4: –û—Å–æ–±–ª–∏–≤—ñ –£–º–æ–≤–∏
1. –ü–æ—á–Ω—ñ—Ç—å –≥—Ä—É
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ "–ú–æ—ó –ö–∞—Ä—Ç–∫–∏" ‚Üí "–û—Å–æ–±–ª–∏–≤–∞ –£–º–æ–≤–∞"
3. **–û—á—ñ–∫—É–≤–∞–Ω–Ω—è**: 
   - –ù–∞–∑–≤–∞ —ñ –æ–ø–∏—Å —É–º–æ–≤–∏ –≤–∏–¥–∏–º—ñ
   - –ö–Ω–æ–ø–∫–∞ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏" –≤–∏–¥–∏–º–∞
   - –ü—Ä–∏ –∫–ª—ñ–∫—É - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è + placeholder alert

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—ñ—Å–ª—è –í–∏–ø—Ä–∞–≤–ª–µ–Ω—å

```bash
# –®–≤–∏–¥–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
./restart.sh

# –ê–±–æ –≤—Ä—É—á–Ω—É
docker compose down
docker compose up --build -d

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
docker compose logs -f app

# –í—ñ–¥–∫—Ä–∏—Ç–∏ –≥—Ä—É
open http://localhost
```

---

## üìä –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü—ñ—Å–ª—è |
|---------|-----|-------|
| **WebSocket –∑'—î–¥–Ω–∞–Ω—å** | 3-5 –Ω–∞ –≥—Ä–∞–≤—Ü—è | 1 –Ω–∞ –≥—Ä–∞–≤—Ü—è |
| **Reconnect delay** | –§—ñ–∫—Å–æ–≤–∞–Ω—ñ 3s | 1s‚Üí2s‚Üí4s‚Üí10s |
| **advance_phase rate** | –ù–µ–æ–±–º–µ–∂–µ–Ω–æ | 1/—Å–µ–∫ max |
| **Timer logging** | –¢—ñ–ª—å–∫–∏ 1 —Ñ–∞–∑–∞ | –í—Å—ñ —Ñ–∞–∑–∏ |
| **UI reactivity** | –ß–∞—Å—Ç–∫–æ–≤–∞ | –ü–æ–≤–Ω–∞ |

---

## üîÆ –©–æ –î–∞–ª—ñ (TODO)

### –í–∏—Å–æ–∫–∏–π –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
1. **Backend: –û—Å–æ–±–ª–∏–≤—ñ –£–º–æ–≤–∏**
   - Endpoint `/api/games/{id}/use-special`
   - –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ—ó –∑ 32 —É–º–æ–≤
   - WebSocket broadcasts

2. **Backend: Fallback Phase Timer**
   - –°–µ—Ä–≤–µ—Ä–Ω–∏–π scheduler
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π advance —è–∫—â–æ –∫–ª—ñ—î–Ω—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î

3. **Frontend: –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π Error Handling**
   - Toast notifications –∑–∞–º—ñ—Å—Ç—å `alert()`
   - Graceful degradation

### –°–µ—Ä–µ–¥–Ω—ñ–π –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
4. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**
   - Unit tests –¥–ª—è timer logic
   - E2E tests –∑ Playwright
   - WebSocket integration tests

5. **UX –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è**
   - Animated phase transitions
   - Sound effects (optional)
   - Loading states

6. **Performance**
   - Redis –¥–ª—è `_last_phase_advance`
   - Connection pooling –¥–ª—è DB
   - WebSocket compression

### –ù–∏–∑—å–∫–∏–π –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
7. **Analytics**
   - Metrics –¥–ª—è phase durations
   - WebSocket connection tracking
   - Error rate monitoring

8. **Admin Panel**
   - Manual game control
   - View all active games
   - Debug tools

---

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

### –î–ª—è –†–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤
- `ARCHITECTURE.md` - –ó–∞–≥–∞–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- `REFACTORING_SUMMARY.md` - –ü–µ—Ä—à–∞ —Ö–≤–∏–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É
- `BUNKER_REVEAL_FIX.md` - –î–µ—Ç–∞–ª—ñ —Ç–∞–π–º–µ—Ä–∞
- `promt.md` - –ü–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏

### –î–ª—è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- `README.md` - –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏
- `CHANGES.md` - Changelog

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –î–µ–ø–ª–æ—î–º

- [x] WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω—ñ
- [x] –¢–∞–π–º–µ—Ä –ª–æ–≥—É—î –¥–ª—è –≤—Å—ñ—Ö —Ñ–∞–∑
- [x] –ö–Ω–æ–ø–∫–∞ "–ü–æ—á–∞—Ç–∏ –ì—Ä—É" –∑–∞–≤–∂–¥–∏ –≤–∏–¥–∏–º–∞
- [x] Rate limiting –ø—Ä–∞—Ü—é—î
- [ ] **TODO**: –û—Å–æ–±–ª–∏–≤—ñ –£–º–æ–≤–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ
- [ ] **TODO**: Backend fallback timer
- [ ] **TODO**: Unit tests –ø–æ–∫—Ä–∏—Ç—Ç—è ‚â•80%

---

## üéâ –í–∏—Å–Ω–æ–≤–æ–∫

### –ë—É–ª–æ: 5/10 ‚ö†Ô∏è
- –ö–Ω–æ–ø–∫–∞ –∑–Ω–∏–∫–∞–ª–∞
- –§–∞–∑–∏ –∑–∞—Å—Ç—Ä—è–≥–∞–ª–∏
- WebSocket –¥—É–±–ª—ñ–∫–∞—Ç–∏
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π debugging

### –°—Ç–∞–ª–æ: 8.5/10 ‚úÖ
- –°—Ç–∞–±—ñ–ª—å–Ω–∏–π WebSocket
- –ù–∞–¥—ñ–π–Ω—ñ —Ñ–∞–∑–∏ –∑ auto-advance
- –ü–æ–≤–Ω–∏–π debugging
- Placeholder –¥–ª—è –û—Å–æ–±–ª–∏–≤–∏—Ö –£–º–æ–≤
- Rate limiting
- Exponential backoff
- Cleanup handlers

### –ó–∞–ª–∏—à–∏–ª–æ—Å—å: üîß
- –ü–æ–≤–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –û—Å–æ–±–ª–∏–≤–∏—Ö –£–º–æ–≤ (32 —Ç–∏–ø–∏)
- Backend fallback timer
- Toast notifications
- Comprehensive testing

---

**–û—Ü—ñ–Ω–∫–∞ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –¥–æ –ü—Ä–æ–¥–∞–∫—à–Ω—É**: 85%  
**–ú–æ–∂–Ω–∞ –≥—Ä–∞—Ç–∏**: ‚úÖ –¢–∞–∫ (–æ—Å–Ω–æ–≤–Ω–∏–π –≥–µ–π–º–ø–ª–µ–π –ø—Ä–∞—Ü—é—î)  
**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–æ—Ä–æ–±–∏—Ç–∏**: –û—Å–æ–±–ª–∏–≤—ñ –£–º–æ–≤–∏ + —Ç–µ—Å—Ç–∏

---

_–î–∞—Ç–∞: 2025-12-02_  
_–í–µ—Ä—Å—ñ—è: 2.1_  
_–°—Ç–∞—Ç—É—Å: ‚úÖ Ready for Testing_
