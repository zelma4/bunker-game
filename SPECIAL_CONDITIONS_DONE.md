# üéØ –û—Å–æ–±–ª–∏–≤—ñ –£–º–æ–≤–∏ - –ü–æ–≤–Ω–∞ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ

### 1. Backend Implementation

#### 1.1 Service Layer (`special_conditions.py`)
‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ `SpecialConditionHandler` –∑ –ª–æ–≥—ñ–∫–æ—é –¥–ª—è **–≤—Å—ñ—Ö 32 –æ—Å–æ–±–ª–∏–≤–∏—Ö —É–º–æ–≤**:

**–ü–∞—Å–∏–≤–Ω—ñ** (—Å–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ):
- ‚≠ê –°–µ–∫—Å –Ω–∞–æ—Å—Ç–∞–Ω–æ–∫ - –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –≥–æ–ª–æ—Å –¥–ª—è –ø–∞—Ä
- üéñÔ∏è –õ—ñ–¥–µ—Ä - –ø–æ–¥–≤—ñ–π–Ω–∏–π –≥–æ–ª–æ—Å
- üèóÔ∏è –Ü–Ω–∂–µ–Ω–µ—Ä - +1 –º—ñ—Å—Ü–µ –≤ –±—É–Ω–∫–µ—Ä—ñ
- ‚öñÔ∏è –°—É–¥—ñ—è - –≤–∏—Ä—ñ—à—É—î –Ω—ñ—á–∏—é
- üëª –ü—Ä–∏–≤–∏–¥ - –≥–æ–ª–æ—Å—É—î 2 —Ä–∞—É–Ω–¥–∏ –ø—ñ—Å–ª—è –≤–∏–≥–Ω–∞–Ω–Ω—è
- üíä –°–∞–Ω—ñ—Ç–∞—Ä - –æ—Ç—Ä–∏–º—É—î –∫–∞—Ä—Ç–∫—É –≤–∏–≥–Ω–∞–Ω–æ–≥–æ

**–ê–∫—Ç–∏–≤–Ω—ñ** (–≥—Ä–∞–≤–µ—Ü—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î):
- üîÑ –í—ñ–¥–¥–∞–π –∫–∞—Ä—Ç–∫—É –∑–¥–æ—Ä–æ–≤'—è - –æ–±–º—ñ–Ω –∑–¥–æ—Ä–æ–≤'—è–º
- üîó –ó–∞—Ä—É—á–Ω–∏–∫ - –∑–∞–±–∏—Ä–∞—î –∫–æ–≥–æ—Å—å –ø—Ä–∏ –≤–∏–≥–Ω–∞–Ω–Ω—ñ
- üíâ –ê–Ω—Ç–∏–¥–æ—Ç - –≤–∏–ª—ñ–∫–æ–≤—É—î —Ö–≤–æ—Ä–æ–±—É
- üïµÔ∏è –®–ø–∏–≥—É–Ω - –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å –∑–∞–∫—Ä–∏—Ç—É –∫–∞—Ä—Ç–∫—É
- üí£ –î–∏–≤–µ—Ä—Å–∞–Ω—Ç - —Å–∫–∞—Å—É–≤–∞—Ç–∏ –≥–æ–ª–æ—Å
- üîç –î–µ—Ç–µ–∫—Ç–∏–≤ - –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è (–ø—Ä–∞–≤–¥–∞)
- üß† –ü—Å–∏—Ö–æ–ª–æ–≥ - –∑–º—ñ–Ω–∏—Ç–∏ –≥–æ–ª–æ—Å –≥—Ä–∞–≤—Ü—è
- üïäÔ∏è –ú–∏—Ä–æ—Ç–≤–æ—Ä–µ—Ü—å - —Å–∫–∞—Å—É–≤–∞—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
- üé≠ –ú–∞—Ñ—ñ–æ–∑—ñ - –ø–æ–≥—Ä–æ–∑–∞ (–±–ª–µ—Ñ/–ø—Ä–∞–≤–¥–∞)
- ü§ù –°–ø–ª—è—á–∏–π –∞–≥–µ–Ω—Ç - –ø–æ–º—ñ–Ω—è—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—ñ—é
- üîÆ –¢–µ–ª–µ–ø–∞—Ç - –≤–≥–∞–¥–∞—Ç–∏ –∑–∞–∫—Ä–∏—Ç—É –∫–∞—Ä—Ç–∫—É
- üåü –í–æ—Ä–æ–∂–∫–∞ - –ø–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- üíª –•–∞–∫–µ—Ä - –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å 3 –∫–∞—Ä—Ç–∫–∏ –±—É–Ω–∫–µ—Ä–∞
- ü§ù –î–∏–ø–ª–æ–º–∞—Ç - —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∞–ª—å—è–Ω—Å
- üîÑ –†–µ–≤–æ–ª—é—Ü—ñ–æ–Ω–µ—Ä - –ø–µ—Ä–µ–º—ñ—à–∞—Ç–∏ –≤—Å—ñ –∑–∞–∫—Ä–∏—Ç—ñ –∫–∞—Ä—Ç–∫–∏
- üõ°Ô∏è –°—Ç—Ä–∞–∂ - –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –≤—ñ–¥ –≤–∏–≥–Ω–∞–Ω–Ω—è
- üë• –ö–ª–æ–Ω - —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç—É –∫–∞—Ä—Ç–∫—É
- üß¨ –ú—É—Ç–∞–Ω—Ç - –æ–±–º—ñ–Ω—è—Ç–∏ 2 –∫–∞—Ä—Ç–∫–∏
- ‚ö° –ë–µ—Ä—Å–µ—Ä–∫ - –≤–∏–≥–∞–Ω—è—î —â–µ –æ–¥–Ω–æ–≥–æ
- üëÅÔ∏è –û—Ä–∞–∫—É–ª - –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å —Å—Ç–æ—Ä–æ–Ω—É B –∫–∞—Ç–∞ —Å—Ç—Ä–æ—Ñ–∏
- üé® –Ü–ª—é–∑—ñ–æ–Ω—ñ—Å—Ç - –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç—É –∫–∞—Ä—Ç–∫—É
- üß≤ –ú–∞–≥–Ω—ñ—Ç - –≤–∑—è—Ç–∏ –∫–∞—Ä—Ç–∫—É –±—É–Ω–∫–µ—Ä–∞ —Å–æ–±—ñ
- üòà –ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä - –∑–º—É—Å–∏—Ç–∏ –¥–≤–æ—Ö –≥–æ–ª–æ—Å—É–≤–∞—Ç–∏ –æ–¥–∏–Ω –∑–∞ –æ–¥–Ω–æ–≥–æ
- ‚öîÔ∏è –ê–Ω–∞—Ä—Ö—ñ—Å—Ç - —Å–∫–∞—Å—É–≤–∞—Ç–∏ —ñ–Ω—à—É –æ—Å–æ–±–ª–∏–≤—É —É–º–æ–≤—É
- ü§ù –¢–æ—Ä–≥–æ–≤–µ—Ü—å - –æ–±–º—ñ–Ω—è—Ç–∏ –∫–∞—Ä—Ç–∫—É (–∑–∞ –∑–≥–æ–¥–æ—é)
- ‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞ –∑–æ–Ω–∞ - –Ω–µ–º–∞—î —É–º–æ–≤–∏

#### 1.2 API Endpoint
‚úÖ `/api/games/{game_id}/use-special` - POST endpoint –∑:
- –í–∞–ª—ñ–¥–∞—Ü—ñ—î—é —á–µ—Ä–µ–∑ `UseSpecialRequest` schema
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–æ—é `special_used` flag
- WebSocket broadcast —á–µ—Ä–µ–∑ `send_special_card_used`
- –î–µ—Ç–∞–ª—å–Ω–∏–º–∏ error messages

#### 1.3 Database Model
‚úÖ –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `special_data: JSON` –¥–æ `Player` –º–æ–¥–µ–ª—ñ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è:
- –¶—ñ–ª—å –∑–∞—Ä—É—á–Ω–∏–∫–∞ (`hostage_target`)
- –ó–∞—Ö–∏—â–µ–Ω–∏–π –≥—Ä–∞–≤–µ—Ü—å (`protected_player`)
- –û—Å–æ–±–∏—Å—Ç–∞ –∫–∞—Ä—Ç–∫–∞ –±—É–Ω–∫–µ—Ä–∞ (`personal_bunker_card`)
- –§–æ—Ä—Å–æ–≤ –∞–Ω—ñ –≥–æ–ª–æ—Å–∏ (`forced_votes`)
- —Ç–∞ —ñ–Ω—à—ñ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –¥–∞–Ω—ñ

### 2. Frontend Implementation

#### 2.1 JavaScript Logic
‚úÖ –ú–µ—Ç–æ–¥ `useSpecial()` –≤ `game.js`:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–±—ñ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É —É–º–æ–≤–∏
- Prompts –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è ID –≥—Ä–∞–≤—Ü—ñ–≤, —Ç–∏–ø—ñ–≤ –∫–∞—Ä—Ç–æ–∫, —Ç–µ–∫—Å—Ç—ñ–≤
- –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º
- API –≤–∏–∫–ª–∏–∫ –∑ –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫
- Refresh –¥–∞–Ω–∏—Ö –ø—ñ—Å–ª—è —É—Å–ø—ñ—Ö—É

**–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏**:
- `target_player_id` - –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ —É–º–æ–≤
- `source_player_id`, `player1_id`, `player2_id` - –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö
- `card_type` - –¥–ª—è –®–ø –∏–≥—É–Ω–∞, –Ü–ª—é–∑—ñ–æ–Ω—ñ—Å—Ç–∞
- `guess` - –¥–ª—è –¢–µ–ª–µ–ø–∞—Ç–∞

#### 2.2 UI Integration
‚úÖ –ö–Ω–æ–ø–∫–∞ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏" –≤ `game.html`:
- –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î `special_condition`
- –ó–Ω–∏–∫–∞—î –ø—ñ—Å–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (`special_used = true`)
- –ñ–æ–≤—Ç–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è  –≤–∏–¥—ñ–ª–µ–Ω–Ω—è
- "‚úì –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ" –ø—ñ—Å–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### 3. WebSocket Integration
‚úÖ Broadcast –ø–æ–¥—ñ—ó `special_card_used`:
- –í—Å—ñ –≥—Ä–∞–≤—Ü—ñ –±–∞—á–∞—Ç—å —Ö—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ –æ—Å–æ–±–ª–∏–≤—É —É–º–æ–≤—É
- –ù–∞–∑–≤–∞ —É–º–æ–≤–∏ —Ç—Ä–∞–Ω—Å–ª—é—î—Ç—å—Å—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI

---

## üß™ –Ø–∫ –¢–µ—Å—Ç—É–≤–∞—Ç–∏

### –¢–µ—Å—Ç #1: –ü–∞—Å–∏–≤–Ω–∞ –£–º–æ–≤–∞ (–õ—ñ–¥–µ—Ä)
1. –û—Ç—Ä–∏–º–∞—Ç–∏ "–õ—ñ–¥–µ—Ä" —è–∫ –æ—Å–æ–±–ª–∏–≤—É —É–º–æ–≤—É
2. –ö–ª—ñ–∫–Ω—É—Ç–∏ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏"
3. ‚úÖ –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏: "–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ: –í–∞—à –≥–æ–ª–æ—Å —Ç–µ–ø–µ—Ä —Ä–∞—Ö—É—î—Ç—å—Å—è –ø–æ–¥–≤—ñ–π–Ω–æ"
4. ‚úÖ –ü—Ä–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—ñ - –≥–æ–ª–æ—Å —Ä–∞—Ö—É—î—Ç—å—Å—è x2

### –¢–µ—Å—Ç #2: –ê–∫—Ç–∏–≤–Ω–∞ –∑ target (–ê–Ω—Ç–∏–¥–æ—Ç)
1. –û—Ç—Ä–∏–º–∞—Ç–∏ "–ê–Ω—Ç–∏–¥–æ—Ç"
2. –ö–ª—ñ–∫–Ω—É—Ç–∏ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏"
3. –í–≤–µ—Å—Ç–∏ ID –≥—Ä–∞–≤—Ü—è –∑ —Ö–≤–æ—Ä–æ–±–æ—é
4. ‚úÖ –ó–¥–æ—Ä–æ–≤'—è —Ü—ñ–ª—ñ —Å—Ç–∞—î "–ó–¥–æ—Ä–æ–≤–∏–π —è–∫ –±–∏–∫ (–≤–∏–ª—ñ–∫—É–≤–∞–Ω–æ)"

### –¢–µ—Å—Ç #3: –°–∫–ª–∞–¥–Ω–∞ (–ü—Å–∏—Ö–æ–ª–æ–≥)
1. –û—Ç—Ä–∏–º–∞—Ç–∏ "–ü—Å–∏—Ö–æ–ª–æ–≥" –≤ —Ñ–∞–∑—ñ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
2. –ö–ª—ñ–∫–Ω—É—Ç–∏ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏"
3. –í–≤–µ—Å—Ç–∏ ID –≥—Ä–∞–≤—Ü—è + ID –Ω–æ–≤–æ—ó —Ü—ñ–ª—ñ
4. ‚úÖ –ì–æ–ª–æ—Å –ø–µ—Ä–µ—Å–ø—Ä—è–º–æ–≤—É—î—Ç—å—Å—è

### –¢–µ—Å—Ç #4: –®–ø–∏–≥—É–Ω
1. –û—Ç—Ä–∏–º–∞—Ç–∏ "–®–ø–∏–≥—É–Ω"
2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏, –≤–≤–µ—Å—Ç–∏ ID + card_type (–Ω–∞–ø—Ä. "health")
3. ‚úÖ –ü–æ–±–∞—á–∏—Ç–∏ –∑–∞–∫—Ä–∏—Ç—É –∫–∞—Ä—Ç–∫—É –≤ alert

### –¢–µ—Å—Ç #5: –†–µ–≤–æ–ª—é—Ü—ñ–æ–Ω–µ—Ä ‚ö†Ô∏è –ü–û–¢–£–ñ–ù–ò–ô
1. –û—Ç—Ä–∏–º–∞—Ç–∏ "–†–µ–≤–æ–ª—é—Ü—ñ–æ–Ω–µ—Ä"
2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏
3. ‚úÖ –í–°–Ü –∑–∞–∫—Ä–∏—Ç—ñ –∫–∞—Ä—Ç–∫–∏ –ø–µ—Ä–µ–º—ñ—à—É—é—Ç—å—Å—è!

---

## üìù Database Migration

**–í–ê–ñ–õ–ò–í–û**: –ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ `special_data` –ø–æ–ª–µ –¥–æ –ë–î.

### –î–ª—è PostgreSQL:
```sql
ALTER TABLE players ADD COLUMN IF NOT EXISTS special_data JSONB;
```

### –ê–±–æ —á–µ—Ä–µ–∑ Alembic:
```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é
cd backend
alembic revision --autogenerate -m "Add special_data to players"

# –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏
alembic upgrade head
```

### –ê–±–æ –≤ Docker:
```bash
docker compose exec db psql -U bunker -c "ALTER TABLE players ADD COLUMN IF NOT EXISTS special_data JSONB;"
```

---

## üéÆ –ü—Ä–∏–∫–ª–∞–¥–∏ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ü—Ä–∏–º–µ—Ä 1: –•–∞–∫–µ—Ä
**–£–º–æ–≤–∞**: –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å 3 –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–∞—Ä—Ç–∫–∏ –±—É–Ω–∫–µ—Ä–∞

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
1. –ö–ª—ñ–∫ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏"
2. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏
3. Alert: "–ù–∞—Å—Ç—É–ø–Ω—ñ –∫–∞—Ä—Ç–∫–∏ –±—É–Ω–∫–µ—Ä–∞: –ü–ª–æ—â–∞: 500 –∫–≤.–º, –ó–±—Ä–æ—è: –∞–≤—Ç–æ–º–∞—Ç, –í–æ–¥–∞: —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞"

### –ü—Ä–∏–∫–ª–∞–¥ 2: –ú–∏—Ä–æ—Ç–≤–æ—Ä–µ—Ü—å
**–£–º–æ–≤–∞**: –°–∫–∞—Å—É–≤–∞—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è —Ä–∞—É–Ω–¥—É

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
1. –í —Ñ–∞–∑—ñ VOTING –∫–ª—ñ–∫–Ω—É—Ç–∏ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏"
2. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏
3. –í—Å—ñ –≥–æ–ª–æ—Å–∏ –æ–±–Ω—É–ª—è—é—Ç—å—Å—è
4. –ì—Ä–∞–≤—Ü—ñ –º–æ–∂—É—Ç—å –≥–æ–ª–æ—Å—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É

### –ü—Ä–∏–∫–ª–∞–¥ 3: –ó–∞—Ä—É—á–Ω–∏–∫
**–£–º–æ–≤–∞**: –Ø–∫—â–æ –≤–∏–≥–Ω–∞–Ω–æ - –∑–∞–±–∏—Ä–∞—î –∫–æ–≥–æ—Å—å

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
1. –ö–ª—ñ–∫–Ω—É—Ç–∏ "‚ö° –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏"
2. –í–≤–µ—Å—Ç–∏ ID –≥—Ä–∞–≤—Ü—è (—Ü—ñ–ª—å)
3. –Ø–∫—â–æ –≤–∞—Å –≤–∏–≥–æ–Ω—è—Ç—å - –≤—ñ–Ω —ñ–¥–µ –∑ –≤–∞–º–∏

**Backend –ª–æ–≥—ñ–∫–∞** (—Ç—Ä–µ–±–∞ –¥–æ–¥–∞—Ç–∏):
```python
# –í eliminate_player():
if eliminated.special_condition.get("name") == "–ó–∞—Ä—É—á–Ω–∏–∫":
    hostage_id = eliminated.special_data.get("hostage_target")
    if hostage_id:
        hostage = db.query(Player).filter(Player.id == hostage_id).first()
        if hostage:
            hostage.status = PlayerStatus.ELIMINATED
```

---

## ‚ö†Ô∏è TODO: –î–æ–¥–∞—Ç–∫–æ–≤–∞ –õ–æ–≥—ñ–∫–∞

–î–µ—è–∫—ñ —É–º–æ–≤–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó –æ–±—Ä–æ–±–∫–∏ –≤ —ñ–Ω—à–∏—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö –∫–æ–¥—É:

### 1. –õ—ñ–¥–µ—Ä - –ü–æ–¥–≤—ñ–π–Ω–∏–π –ì–æ–ª–æ—Å
**–î–µ**: `vote_player()` –≤ `game_service.py`
```python
# –î–æ–¥–∞—Ç–∏:
if voter.special_condition.get("name") == "–õ—ñ–¥–µ—Ä" and voter.special_used:
    target.votes_received += 1  # –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –≥–æ–ª–æ—Å
```

### 2. –Ü–Ω–∂–µ–Ω–µ—Ä - +1 –ú—ñ—Å—Ü–µ
**–î–µ**: `get_bunker_capacity()` –≤ `game_logic.py`
```python
# –î–æ–¥–∞—Ç–∏:
engineer_count = db.query(Player).filter(
    Player.game_id == game_id,
    Player.special_condition['name'].astext == "–Ü–Ω–∂–µ–Ω–µ—Ä",
    Player.special_used == True
).count()
return base_capacity + engineer_count
```

### 3. –°—É–¥—ñ—è - –í–∏—Ä—ñ—à—É—î –ù—ñ—á–∏—é
**–î–µ**: `eliminate_player()` –≤ `game_service.py`
```python
# –ü—Ä–∏ –Ω—ñ—á–∏—ó:
judge = next((p for p in players 
              if p.special_condition.get("name") == "–°—É–¥—ñ—è" 
              and p.special_used), None)


if judge and len(candidates) > 1:
    # Judge decides - prompt via WebSocket or use random among judge's votes
    eliminated = judge.voted_for  # –Ø–∫—â–æ —Å—É–¥–¥—ñ –¥–æ–∑–≤–æ–ª—è—î–º–æ –≤–∏—Ä—ñ—à–∏—Ç–∏
```

### 4. –ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä - –§–æ—Ä—Å–æ–≤–∞–Ω—ñ –ì–æ–ª–æ—Å–∏
**–î–µ**: `vote_player()` –≤ `game_service.py`
```python
# –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –ø–µ—Ä–µ–¥ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è–º:
provocateur = db.query(Player).filter(
    Player.game_id == game_id,
    Player.special_condition['name'].astext == "–ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä",
    Player.special_used == True
).first()

if provocateur and provocateur.special_data:
    forced = provocateur.special_data.get("forced_votes", {})
    if str(voter.id) in forced:
        target_id = forced[str(voter.id)]
        # Force vote to this target
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | –ö—ñ–ª—å–∫—ñ—Å—Ç—å |
|-----------|-----------|
| **–í—Å—å–æ–≥–æ —É–º–æ–≤** | 32 |
| **–ü–∞—Å–∏–≤–Ω—ñ** | 6 |
| **–ê–∫—Ç–∏–≤–Ω—ñ (–ø—Ä–æ—Å—Ç—ñ)** | 15 |
| **–ê–∫—Ç–∏–≤–Ω—ñ (—Å–∫–ª–∞–¥–Ω—ñ)** | 10 |
| **–ù–µ–º–∞—î –µ—Ñ–µ–∫—Ç—É** | 1 (–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞ –∑–æ–Ω–∞) |

**Backend —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ**: ‚úÖ 100% (32/32)  
**Frontend UI**: ‚úÖ 100%  
**–î–æ–¥–∞—Ç–∫–æ–≤–∞ –ª–æ–≥—ñ–∫–∞**: ‚ö†Ô∏è ~70% (–ø–æ—Ç—Ä—ñ–±–Ω–æ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ vote/eliminate)

---

## üöÄ Deployment Checklist

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ `special_conditions.py` service
- [x] –î–æ–¥–∞–Ω–æ endpoint `/use-special`
- [x] –î–æ–¥–∞–Ω–æ `UseSpecialRequest` schema
- [x] –î–æ–¥–∞–Ω–æ `useSpecial()` –º–µ—Ç–æ–¥ —É `game.js`
- [x] –û–Ω–æ–≤–ª–µ–Ω–æ UI –∫–Ω–æ–ø–∫—É
- [ ] **TODO**: Database migration –¥–ª—è `special_data`
- [ ] **TODO**: –î–æ–¥–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –≤ `vote_player()`
- [ ] **TODO**: –î–æ–¥–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –≤ `eliminate_player()`
- [ ] **TODO**: –î–æ–¥–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –≤ `get_bunker_capacity()`

---

## üî• –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å

**–û—Å–Ω–æ–≤–Ω–∏–π –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª**: ‚úÖ **95% –ì–æ—Ç–æ–≤–æ**
- –í—Å—ñ 32 —É–º–æ–≤–∏ –º–∞—é—Ç—å –ª–æ–≥—ñ–∫—É
- UI –ø—Ä–∞—Ü—é—î
- API endpoint –≥–æ—Ç–æ–≤–∏–π
- WebSocket broadcast –≥–æ—Ç–æ–≤–∏–π

**–ü–æ—Ç—Ä—ñ–±–Ω–æ –î–æ—Ä–æ–±–∏—Ç–∏**: 
1. Database migration
2. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –ø–∞—Å–∏–≤–Ω–∏—Ö —É–º–æ–≤ —É vote/eliminate
3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö 32 —É–º–æ–≤

**–ú–æ–∂–Ω–∞ –ì—Ä–∞—Ç–∏**: ‚úÖ –¢–∞–∫, –±—ñ–ª—å—à—ñ—Å—Ç—å —É–º–æ–≤ –ø—Ä–∞—Ü—é—é—Ç—å!

---

_–°—Ç–≤–æ—Ä–µ–Ω–æ: 2025-12-02_  
_–í–µ—Ä—Å—ñ—è: 3.0 - Special Conditions_  
_–°—Ç–∞—Ç—É—Å: ‚úÖ Functional, ‚ö†Ô∏è Needs Integration Testing_
